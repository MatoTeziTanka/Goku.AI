# üöÄ Master Prompt v3.0.0 Migration Guide

**Date:** 2025-11-27  
**From:** v2.9.0 ‚Üí v3.0.0  
**Type:** Major Architectural Upgrade

---

## üìä What Changed

### **Major Additions**
1. **Operational Modes** - Context-aware agent switching (Architect, Coder, Debug, Strategy, Teaching)
2. **Chain of Thought Engine** - Mandatory reasoning protocol for complex operations
3. **Memory Revision Protocol** - Contradiction detection and resolution
4. **Tool Selection Heuristics** - "Least Privilege" execution rules
5. **Architecture Guidance** - "Brain vs Agents" conceptual framework

### **Key Improvements**
- Enhanced security enforcement (blocking requirements)
- Clearer operational mode definitions
- Better state management protocols
- Explicit "Universal Brain" architecture guidance

---

## üîÑ Migration Steps

### **Step 1: File Replacement** ‚úÖ
- [x] `MASTER_PROMPT_PRODUCTION.md` overwritten with v3.0.0

### **Step 2: Manual Integration** ‚è≠Ô∏è
**Action Required:** Integrate Master Prompt into API

**File:** `src/api/shenron_api_v5_mcp.py` or `src/main.py`

**What to do:**
```python
# Load Master Prompt as system context
MASTER_PROMPT_PATH = Path(__file__).parent.parent.parent / "MASTER_PROMPT_PRODUCTION.md"
MASTER_PROMPT = MASTER_PROMPT_PATH.read_text(encoding='utf-8')

# When querying VM100, prepend Master Prompt to system message
system_message = f"{MASTER_PROMPT}\n\nYou are operating in CODER MODE (Goku/Vegeta)."
```

### **Step 3: Activate Ports Registry** ‚è≠Ô∏è
**Action Required:** Fill in actual ports in `docs/infrastructure/PORTS_REGISTRY.md`

**Current Status:**
- VM100: Port 1234 (LM Studio) ‚úÖ
- VM101: Port 5000 (API), Port 9001 (Code Server) ‚úÖ
- VM120: Ports 80/443 (Reverse Proxy) ‚ùì
- VM150: Ports 80/443 (WordPress/HTML) ‚ùì

**Action:** Update registry with all known ports

### **Step 4: Implement Operational Modes** ‚è≠Ô∏è
**Action Required:** Add mode switching logic to API

**Implementation:**
```python
OPERATIONAL_MODES = {
    "architect": "ARCHITECT MODE: Pure system design. No code.",
    "coder": "CODER MODE (Goku/Vegeta): Strict v3.0.0 adherence.",
    "debug": "DEBUG MODE (Shenron): Root cause analysis.",
    "strategy": "STRATEGY MODE (Frieza): Business logic.",
    "teaching": "TEACHING MODE (Gohan): Explain concepts."
}
```

### **Step 5: Implement State Machines** ‚è≠Ô∏è
**Action Required:** Create state tracking for each warrior

**Location:** `src/services/warrior_states.py`

**Structure:**
```python
{
    "goku": {
        "current_task": None,
        "queue": [],
        "memory_log": [],
        "last_activity": None
    },
    # ... other warriors
}
```

---

## üéØ Immediate Next Steps

1. ‚úÖ **File Updated** - Master Prompt v3.0.0 installed
2. ‚è≠Ô∏è **API Integration** - Load Master Prompt into API system context
3. ‚è≠Ô∏è **Ports Registry** - Complete with all known ports
4. ‚è≠Ô∏è **Operational Modes** - Implement mode switching
5. ‚è≠Ô∏è **State Machines** - Create warrior state tracking

---

## üìù Notes

- **Architecture Shift:** From "patching files" to "Architecture Engineering"
- **Universal Brain:** Master Prompt is now the "Kernel" of the AI
- **State Management:** Warriors are state machines, not separate models
- **Integration:** Master Prompt must be injected into every VM100 query

---

**Status:** Ready for Manual Integration  
**Next Action:** Integrate Master Prompt into API system context

